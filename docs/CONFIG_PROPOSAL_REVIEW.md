# CONFIG_MANAGEMENT_PROPOSAL.md å®¡æŸ¥æŠ¥å‘Š

> å®¡æŸ¥æ—¥æœŸ: 2026-01-24
> å®¡æŸ¥èŒƒå›´: å¯¹æ¯”æ–¹æ¡ˆä¸å½“å‰ä»£ç åº“å®é™…çŠ¶æ€

---

## 1. å®¡æŸ¥ç»“è®º

### æ€»ä½“è¯„ä¼°

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **æ–¹æ¡ˆè®¾è®¡** | âœ… ä¼˜ç§€ | æ¶æ„æ¸…æ™°ï¼Œåˆ†å±‚åˆç† |
| **ä¸å½“å‰ç³»ç»Ÿå…¼å®¹æ€§** | âš ï¸ éœ€æ›´æ–° | éƒ¨åˆ†æ–‡ä»¶è·¯å¾„å’Œå‚æ•°å·²å˜åŒ– |
| **èƒ½å¦å®ç°ç›®æ ‡** | âœ… å¯è¡Œ | èƒ½å®ç°ç»Ÿä¸€é…ç½®ç®¡ç†ç›®æ ‡ |
| **å®æ–½é£é™©** | ä¸­ç­‰ | éœ€å¤„ç†é—ç•™å†²çª |

### æ ¸å¿ƒé—®é¢˜

**æ–¹æ¡ˆå¯ä»¥å®ç°ç»Ÿä¸€é…ç½®ç®¡ç†ç›®æ ‡ï¼Œä½†éœ€è¦æ›´æ–°ä»¥ä¸‹å†…å®¹ï¼š**

1. æ–¹æ¡ˆåˆ—å‡º 36 å¤„ç¡¬ç¼–ç ï¼Œå®é™…å‘ç° **42 å¤„**ï¼ˆ+6 æ–°å¢ï¼‰
2. éƒ¨åˆ†ç¡¬ç¼–ç ä½ç½®å·²å˜åŒ–ï¼ˆtrading_logic.py æ˜¯æ–°æ–‡ä»¶ï¼‰
3. å­˜åœ¨ **3 å¤„ä¸¥é‡é…ç½®å†²çª**ï¼ˆmain_live.py ç¡¬ç¼–ç è¦†ç›– YAMLï¼‰

---

## 2. æ–¹æ¡ˆä¸å®é™…å¯¹æ¯”

### 2.1 ç¡¬ç¼–ç ç»Ÿè®¡å¯¹æ¯”

| ç±»åˆ« | æ–¹æ¡ˆæ•°é‡ | å®é™…æ•°é‡ | å·®å¼‚ |
|------|---------|---------|------|
| äº¤æ˜“æ ¸å¿ƒå‚æ•° (P0) | 4 | 7 | +3 |
| ç½‘ç»œé‡è¯•å‚æ•° (P1) | 7 | 10 | +3 |
| AI/åˆ†æå‚æ•° (P2) | 2 | 4 | +2 |
| æµ‹è¯•æ¨¡å¼å‚æ•° (P3) | 4 | 4 | 0 |
| **å…¶ä»–æœªåˆ—å‡º** | 0 | 6 | +6 |
| **å·²é…ç½®åŒ–** | - | 14 | - |
| **æ€»è®¡å¾…å¤„ç†** | 36 | 28 | -8 (éƒ¨åˆ†å·²é…ç½®) |

### 2.2 æ–¹æ¡ˆä¸­å·²è¿‡æ—¶çš„å†…å®¹

#### æ–‡ä»¶è·¯å¾„å˜åŒ–

| æ–¹æ¡ˆä¸­è·¯å¾„ | å®é™…è·¯å¾„ | çŠ¶æ€ |
|-----------|---------|------|
| `deepseek_strategy.py:1067` | `strategy/trading_logic.py:294` | å·²è¿ç§» |
| `deepseek_strategy.py:1085` | `strategy/trading_logic.py:311` | å·²è¿ç§» |
| `deepseek_strategy.py:566` | `strategy/deepseek_strategy.py:473` | è¡Œå·å˜åŒ– |
| `deepseek_strategy.py:409-410` | `strategy/deepseek_strategy.py:424-425` | è¡Œå·å˜åŒ– |

#### æ–°å¢æ–‡ä»¶æœªåœ¨æ–¹æ¡ˆä¸­

```
strategy/trading_logic.py  # æ–°æ–‡ä»¶ï¼ŒåŒ…å«æ ¸å¿ƒäº¤æ˜“å¸¸é‡
```

### 2.3 æ–¹æ¡ˆä¸­ç¼ºå¤±çš„æ–°å¢ç¡¬ç¼–ç 

| æ–‡ä»¶ | è¡Œ | å€¼ | è¯´æ˜ |
|------|-----|-----|------|
| `trading_logic.py` | 370 | `MIN_SL_DISTANCE_PCT = 0.01` | æœ€å°æ­¢æŸè·ç¦» |
| `trading_logic.py` | 374-376 | `DEFAULT_SL/TP_PCT` | é»˜è®¤æ­¢æŸæ­¢ç›ˆ |
| `sentiment_client.py` | 89 | `timeout=10` | æƒ…ç»ªæ•°æ®è¶…æ—¶ |
| `telegram_bot.py` | 185 | `timeout=30` | æ¶ˆæ¯å‘é€è¶…æ—¶ |
| `deepseek_client.py` | 58 | `maxlen=30` | ä¿¡å·å†å²å¤§å° |
| `multi_agent_analyzer.py` | 138 | `max_json_retries=2` | JSONè§£æé‡è¯• |

---

## 3. ä¸¥é‡é—®é¢˜ï¼šé…ç½®å†²çª

### ğŸ”´ é—®é¢˜ 1: RSI é˜ˆå€¼å†²çª

```python
# main_live.py:214-215 (ç¡¬ç¼–ç )
rsi_extreme_threshold_upper=75.0,
rsi_extreme_threshold_lower=25.0,

# strategy_config.yaml:60-61 (è¢«å¿½ç•¥)
rsi_extreme_threshold_upper: 70
rsi_extreme_threshold_lower: 30
```

**å½±å“**: YAML é…ç½®å®Œå…¨æ— æ•ˆï¼Œä¿®æ”¹ YAML ä¸ä¼šç”Ÿæ•ˆ

### ğŸ”´ é—®é¢˜ 2: DeepSeek Temperature å†²çª

```python
# main_live.py:201 (ç¡¬ç¼–ç )
deepseek_temperature=0.1,

# strategy_config.yaml:41 (è¢«å¿½ç•¥)
temperature: 0.3
```

**å½±å“**: AI æ¨¡å‹å®é™…ä½¿ç”¨ 0.1ï¼Œä¸æ–‡æ¡£ä¸ç¬¦

### ğŸ”´ é—®é¢˜ 3: min_trade_amount å†²çª

```python
# main_live.py:187 (ç¡¬ç¼–ç )
min_trade_amount=0.001,

# strategy_config.yaml:23 (è¢«å¿½ç•¥)
min_trade_amount: 0.001
```

**å½±å“**: è™½ç„¶å€¼ç›¸åŒï¼Œä½† YAML ä¿®æ”¹æ— æ•ˆ

---

## 4. æ–¹æ¡ˆè®¾è®¡è¯„ä¼°

### 4.1 ä¼˜ç‚¹ âœ…

| è®¾è®¡ | è¯„ä»· |
|------|------|
| åˆ†å±‚åŠ è½½ (base â†’ env â†’ .env) | åˆç†ï¼Œç¬¦åˆè¡Œä¸šæƒ¯ä¾‹ |
| ConfigManager ç±»è®¾è®¡ | å®Œæ•´ï¼ŒåŒ…å«éªŒè¯å’Œç±»å‹å®‰å…¨ |
| ç¯å¢ƒéš”ç¦» (production/development/backtest) | å®ç”¨ï¼Œè§£å†³æµ‹è¯•/ç”Ÿäº§å‚æ•°åˆ‡æ¢ |
| è¿ç§»è®¡åˆ’ (6 é˜¶æ®µ) | æ¸è¿›å¼ï¼Œé£é™©å¯æ§ |

### 4.2 éœ€è¦è¡¥å…… âš ï¸

| ç¼ºå¤± | å»ºè®® |
|------|------|
| trading_logic.py å¸¸é‡ | æ·»åŠ  `trading_logic` é…ç½®èŠ‚ |
| ç½‘ç»œè¶…æ—¶é…ç½® | å®Œå–„ `network` é…ç½®èŠ‚ |
| ä¿¡å·å†å²å¤§å° | æ·»åŠ åˆ° `ai.signal` é…ç½®èŠ‚ |

### 4.3 base.yaml è¡¥å……å»ºè®®

```yaml
# æ–°å¢é…ç½®èŠ‚
trading_logic:
  min_notional_usdt: 100.0
  min_notional_safety_margin: 1.01
  min_sl_distance_pct: 0.01
  min_tp_distance_pct: 0.005
  default_sl_pct: 0.02
  default_tp_pct: 0.03

network:
  # è¡¥å……
  sentiment_timeout: 10
  telegram_message_timeout: 30
  instrument_discovery_retries: 60
  instrument_discovery_interval: 1.0

ai:
  signal:
    history_count: 30  # å½“å‰ maxlen=30
    skip_on_divergence: true
```

---

## 5. èƒ½å¦å®ç°ç›®æ ‡ï¼Ÿ

### ç›®æ ‡ 1: ç»Ÿä¸€é…ç½®ç®¡ç† âœ…

**å¯ä»¥å®ç°**ã€‚æ–¹æ¡ˆçš„ ConfigManager + base.yaml æ¶æ„å¯ä»¥ï¼š
- é›†ä¸­æ‰€æœ‰å‚æ•°å®šä¹‰
- æ¶ˆé™¤å¤šå¤„é»˜è®¤å€¼é‡å¤
- æä¾›å•ä¸€é…ç½®æ¥æº

### ç›®æ ‡ 2: å‚æ•°ç®¡ç† âœ…

**å¯ä»¥å®ç°**ã€‚æ–¹æ¡ˆæä¾›ï¼š
- ç±»å‹éªŒè¯
- èŒƒå›´æ£€æŸ¥
- ç¯å¢ƒåˆ‡æ¢

### ç›®æ ‡ 3: é˜²æ­¢ç¡¬ç¼–ç  âš ï¸

**éƒ¨åˆ†å¯ä»¥å®ç°**ã€‚éœ€è¦é¢å¤–å·¥ä½œï¼š

1. **ä¿®å¤ç°æœ‰å†²çª** - main_live.py å¿…é¡»æ”¹ä¸ºä»é…ç½®åŠ è½½
2. **è¿ç§» trading_logic.py å¸¸é‡** - éœ€è¦ä¿®æ”¹å¯¼å…¥æ–¹å¼
3. **æ·»åŠ ä»£ç æ£€æŸ¥** - é˜²æ­¢æ–°å¢ç¡¬ç¼–ç 

---

## 6. å®æ–½å»ºè®®

### 6.1 ç´§æ€¥ä¿®å¤ (Phase 0)

åœ¨å®æ–½æ–¹æ¡ˆå‰ï¼Œå…ˆä¿®å¤ 3 å¤„é…ç½®å†²çªï¼š

```python
# main_live.py ä¿®æ”¹
# Before:
rsi_extreme_threshold_upper=75.0,
rsi_extreme_threshold_lower=25.0,
deepseek_temperature=0.1,

# After:
rsi_extreme_threshold_upper=risk_config.get('rsi_extreme_threshold_upper', 70.0),
rsi_extreme_threshold_lower=risk_config.get('rsi_extreme_threshold_lower', 30.0),
deepseek_temperature=deepseek_config.get('temperature', 0.3),
```

### 6.2 æ›´æ–°æ–¹æ¡ˆ (Phase 1)

1. æ›´æ–° base.yaml æ·»åŠ æ–°å‘ç°çš„å‚æ•°
2. æ›´æ–°æ–‡ä»¶è·¯å¾„å¼•ç”¨ (trading_logic.py)
3. æ·»åŠ æ–°å¢çš„ 6 å¤„ç¡¬ç¼–ç åˆ°å¾…å¤„ç†åˆ—è¡¨

### 6.3 å®æ–½é¡ºåºè°ƒæ•´

| é˜¶æ®µ | å†…å®¹ | ä¼˜å…ˆçº§ |
|------|------|--------|
| Phase 0 | ä¿®å¤ main_live.py é…ç½®å†²çª | **ç´§æ€¥** |
| Phase 1 | åˆ›å»º ConfigManager + base.yaml | é«˜ |
| Phase 2 | ä¿®æ”¹ main_live.py ä½¿ç”¨ ConfigManager | é«˜ |
| Phase 3 | è¿ç§» trading_logic.py å¸¸é‡ | ä¸­ |
| Phase 4 | è¿ç§» utils ç¡¬ç¼–ç  | ä¸­ |
| Phase 5 | æ·»åŠ ç¯å¢ƒåˆ‡æ¢ CLI | ä½ |
| Phase 6 | æµ‹è¯•å’Œæ–‡æ¡£ | ä½ |

---

## 7. é£é™©è¯„ä¼°æ›´æ–°

| é£é™© | åŸè¯„ä¼° | æ›´æ–°è¯„ä¼° | åŸå›  |
|------|--------|----------|------|
| é…ç½®åŠ è½½å¤±è´¥ | ä½ | ä½ | ä¸å˜ |
| ç±»å‹è½¬æ¢é”™è¯¯ | ä¸­ | ä¸­ | ä¸å˜ |
| **ç°æœ‰åŠŸèƒ½å›å½’** | æœªè¯„ä¼° | **ä¸­** | trading_logic.py å¸¸é‡è¢«å¤šå¤„å¼•ç”¨ |
| **é…ç½®å†²çªå¯¼è‡´è¡Œä¸ºå˜åŒ–** | æœªè¯„ä¼° | **é«˜** | RSI/æ¸©åº¦ä¿®å¤ä¼šæ”¹å˜ç³»ç»Ÿè¡Œä¸º |

### ç¼“è§£æªæ–½

1. **å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯** - ä¿®å¤å†²çªåè§‚å¯Ÿä¿¡å·å˜åŒ–
2. **æ·»åŠ é…ç½®è¿ç§»æ—¥å¿—** - è®°å½•æ–°æ—§å€¼å¯¹æ¯”
3. **ä¿ç•™å›æ»šèƒ½åŠ›** - æ¯ä¸ª Phase å•ç‹¬ commit

---

## 8. ç»“è®º

### æ–¹æ¡ˆå¯è¡Œæ€§: âœ… å¯è¡Œ

CONFIG_MANAGEMENT_PROPOSAL.md çš„æ ¸å¿ƒè®¾è®¡æ˜¯åˆç†çš„ï¼Œå¯ä»¥å®ç°ç»Ÿä¸€é…ç½®ç®¡ç†ç›®æ ‡ã€‚

### éœ€è¦æ›´æ–°çš„å†…å®¹

1. **è¡¥å…… 6 å¤„æ–°å‘ç°çš„ç¡¬ç¼–ç **
2. **æ›´æ–°æ–‡ä»¶è·¯å¾„å¼•ç”¨** (trading_logic.py)
3. **æ·»åŠ  Phase 0** ç´§æ€¥ä¿®å¤é…ç½®å†²çª
4. **æ‰©å±• base.yaml** æ·»åŠ  trading_logic å’Œ network é…ç½®èŠ‚

### å®æ–½ä¼˜å…ˆçº§

```
ğŸ”´ ç´§æ€¥: ä¿®å¤ main_live.py ä¸­çš„ 3 å¤„é…ç½®å†²çª
ğŸŸ  é«˜:   åˆ›å»º ConfigManager å¹¶è¿ç§»æ ¸å¿ƒé…ç½®
ğŸŸ¡ ä¸­:   è¿ç§» trading_logic.py å’Œ utils ç¡¬ç¼–ç 
ğŸŸ¢ ä½:   æ·»åŠ ç¯å¢ƒåˆ‡æ¢å’Œé«˜çº§åŠŸèƒ½
```

---

*å®¡æŸ¥å®Œæˆã€‚å»ºè®®å…ˆæ‰§è¡Œ Phase 0 ä¿®å¤å†²çªï¼Œå†æŒ‰æ›´æ–°åçš„æ–¹æ¡ˆå®æ–½ã€‚*
