#!/usr/bin/env python3
"""
å…¨éƒ¨æ•°æ®æºè¯Šæ–­è„šæœ¬

å¯¹æ¯”åˆ†æ:
1. Coinalyze API - æ‰€æœ‰å¯ç”¨ç«¯ç‚¹
2. Binance API - Kçº¿12åˆ— + å…¶ä»–ç«¯ç‚¹
3. æ•°æ®é‡å åˆ†æ
4. æœªåˆ©ç”¨æ•°æ®è¯†åˆ«

ç”¨æ³•:
    cd /home/linuxuser/nautilus_AItrader
    source venv/bin/activate
    python3 scripts/diagnose_all_data_sources.py
"""

import os
import sys
import json
import time
import requests
from pathlib import Path
from datetime import datetime

project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

from dotenv import load_dotenv

env_file = Path.home() / ".env.aitrader"
if env_file.exists():
    load_dotenv(env_file)
else:
    load_dotenv(project_root / ".env")


def print_header(title: str):
    print("\n" + "=" * 70)
    print(f"  {title}")
    print("=" * 70)


def print_subheader(title: str):
    print(f"\n{'â”€' * 50}")
    print(f"  {title}")
    print(f"{'â”€' * 50}")


def fetch_json(url: str, params: dict = None, headers: dict = None, timeout: int = 10):
    """é€šç”¨ JSON è¯·æ±‚"""
    try:
        response = requests.get(url, params=params, headers=headers, timeout=timeout)
        if response.status_code == 200:
            return {"ok": True, "data": response.json()}
        else:
            return {"ok": False, "status": response.status_code, "error": response.text[:200]}
    except Exception as e:
        return {"ok": False, "error": str(e)}


def main():
    print_header("å…¨éƒ¨æ•°æ®æºè¯Šæ–­å·¥å…·")
    print(f"â° æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")

    coinalyze_key = os.getenv("COINALYZE_API_KEY")
    symbol_binance = "BTCUSDT"
    symbol_coinalyze = "BTCUSDT_PERP.A"
    now = int(time.time())

    # =========================================================================
    # PART 1: Coinalyze API å®Œæ•´æµ‹è¯•
    # =========================================================================
    print_header("PART 1: Coinalyze API å®Œæ•´ç«¯ç‚¹æµ‹è¯•")

    if not coinalyze_key:
        print("  âŒ COINALYZE_API_KEY æœªè®¾ç½®ï¼Œè·³è¿‡ Coinalyze æµ‹è¯•")
        coinalyze_data = {}
    else:
        print(f"  âœ… API Key: {coinalyze_key[:8]}...")

        coinalyze_endpoints = [
            # å½“å‰å€¼
            ("/open-interest", "OI (å½“å‰)", {"symbols": symbol_coinalyze}),
            ("/funding-rate", "èµ„é‡‘è´¹ç‡ (å½“å‰)", {"symbols": symbol_coinalyze}),

            # å†å²æ•°æ®
            ("/open-interest-history", "OI å†å²", {"symbols": symbol_coinalyze, "interval": "1hour", "from": now-7200, "to": now}),
            ("/funding-rate-history", "èµ„é‡‘è´¹ç‡å†å²", {"symbols": symbol_coinalyze, "interval": "1hour", "from": now-7200, "to": now}),
            ("/liquidation-history", "çˆ†ä»“å†å²", {"symbols": symbol_coinalyze, "interval": "1hour", "from": now-7200, "to": now}),
            ("/long-short-ratio-history", "å¤šç©ºæ¯”å†å²", {"symbols": symbol_coinalyze, "interval": "1hour", "from": now-7200, "to": now}),

            # å…¶ä»–å¯èƒ½çš„ç«¯ç‚¹
            ("/predicted-funding-rate", "é¢„æµ‹èµ„é‡‘è´¹ç‡", {"symbols": symbol_coinalyze}),
            ("/aggregate-open-interest", "èšåˆOI", {"symbols": symbol_coinalyze}),
            ("/aggregate-funding-rate", "èšåˆèµ„é‡‘è´¹ç‡", {"symbols": symbol_coinalyze}),
        ]

        coinalyze_data = {}
        for endpoint, name, params in coinalyze_endpoints:
            url = f"https://api.coinalyze.net/v1{endpoint}"
            headers = {"api_key": coinalyze_key}
            result = fetch_json(url, params, headers)

            status = "âœ…" if result["ok"] else "âŒ"
            print(f"\n  {status} {name} ({endpoint})")

            if result["ok"]:
                data = result["data"]
                if isinstance(data, list) and len(data) > 0:
                    sample = data[0]
                    coinalyze_data[endpoint] = sample
                    print(f"     å­—æ®µ: {list(sample.keys())}")

                    # å±•ç¤ºå…³é”®æ•°æ®
                    if "history" in sample:
                        hist = sample["history"]
                        print(f"     å†å²è®°å½•æ•°: {len(hist)}")
                        if hist:
                            print(f"     å†å²å­—æ®µ: {list(hist[0].keys())}")
                            print(f"     æœ€æ–°è®°å½•: {hist[-1]}")
                    else:
                        print(f"     æ•°æ®: {sample}")
                else:
                    print(f"     ç©ºæ•°æ®æˆ–æ ¼å¼å¼‚å¸¸: {data}")
            else:
                print(f"     é”™è¯¯: {result.get('error', result.get('status'))}")

    # =========================================================================
    # PART 2: Binance API å®Œæ•´æµ‹è¯•
    # =========================================================================
    print_header("PART 2: Binance API å®Œæ•´ç«¯ç‚¹æµ‹è¯•")

    binance_base = "https://fapi.binance.com"

    binance_endpoints = [
        # Kçº¿ (12åˆ—)
        ("/fapi/v1/klines", "Kçº¿æ•°æ® (12åˆ—)", {"symbol": symbol_binance, "interval": "15m", "limit": 2}),

        # èµ„é‡‘è´¹ç‡
        ("/fapi/v1/premiumIndex", "æ ‡è®°ä»·æ ¼+èµ„é‡‘è´¹ç‡", {"symbol": symbol_binance}),
        ("/fapi/v1/fundingRate", "èµ„é‡‘è´¹ç‡å†å²", {"symbol": symbol_binance, "limit": 3}),

        # æŒä»“é‡
        ("/futures/data/openInterestHist", "OI å†å²", {"symbol": symbol_binance, "period": "15m", "limit": 3}),

        # å¤šç©ºæ¯”
        ("/futures/data/globalLongShortAccountRatio", "å…¨å±€å¤šç©ºè´¦æˆ·æ¯”", {"symbol": symbol_binance, "period": "15m", "limit": 3}),
        ("/futures/data/topLongShortAccountRatio", "å¤§æˆ·å¤šç©ºè´¦æˆ·æ¯”", {"symbol": symbol_binance, "period": "15m", "limit": 3}),
        ("/futures/data/topLongShortPositionRatio", "å¤§æˆ·å¤šç©ºæŒä»“æ¯”", {"symbol": symbol_binance, "period": "15m", "limit": 3}),

        # Taker ä¹°å–æ¯”
        ("/futures/data/takerlongshortRatio", "Takerå¤šç©ºæ¯”", {"symbol": symbol_binance, "period": "15m", "limit": 3}),

        # çˆ†ä»“ (éœ€è¦ç‰¹æ®Šå¤„ç†)
        # Binance æ²¡æœ‰ç›´æ¥çš„çˆ†ä»“ APIï¼Œéœ€è¦ç”¨ WebSocket æˆ–ç¬¬ä¸‰æ–¹

        # å…¶ä»–
        ("/fapi/v1/ticker/24hr", "24hè¡Œæƒ…", {"symbol": symbol_binance}),
        ("/fapi/v1/depth", "æ·±åº¦æ•°æ®", {"symbol": symbol_binance, "limit": 5}),
    ]

    binance_data = {}
    for endpoint, name, params in binance_endpoints:
        url = f"{binance_base}{endpoint}"
        result = fetch_json(url, params)

        status = "âœ…" if result["ok"] else "âŒ"
        print(f"\n  {status} {name} ({endpoint})")

        if result["ok"]:
            data = result["data"]
            binance_data[endpoint] = data

            if isinstance(data, list):
                if len(data) > 0:
                    sample = data[0]
                    if isinstance(sample, list):
                        # Kçº¿æ ¼å¼
                        print(f"     åˆ—æ•°: {len(sample)}")
                        print(f"     Kçº¿åˆ—è¯´æ˜:")
                        kline_cols = [
                            "[0] open_time", "[1] open", "[2] high", "[3] low", "[4] close",
                            "[5] volume", "[6] close_time", "[7] quote_volume â­",
                            "[8] trades_count â­", "[9] taker_buy_volume â­",
                            "[10] taker_buy_quote â­", "[11] ignore"
                        ]
                        for i, col in enumerate(kline_cols):
                            if i < len(sample):
                                print(f"        {col}: {sample[i]}")
                    else:
                        print(f"     å­—æ®µ: {list(sample.keys()) if isinstance(sample, dict) else sample}")
                        print(f"     ç¤ºä¾‹: {sample}")
            elif isinstance(data, dict):
                print(f"     å­—æ®µ: {list(data.keys())}")
                # æ˜¾ç¤ºå…³é”®å­—æ®µ
                important_keys = ['lastFundingRate', 'nextFundingTime', 'markPrice', 'indexPrice',
                                  'longAccount', 'shortAccount', 'longShortRatio', 'buySellRatio',
                                  'sumOpenInterest', 'sumOpenInterestValue']
                for key in important_keys:
                    if key in data:
                        print(f"     {key}: {data[key]}")
        else:
            print(f"     é”™è¯¯: {result.get('error', result.get('status'))}")

    # =========================================================================
    # PART 3: æ•°æ®å¯¹æ¯”åˆ†æ
    # =========================================================================
    print_header("PART 3: æ•°æ®å¯¹æ¯”åˆ†æ")

    print_subheader("3.1 ç›¸åŒ/é‡å çš„æ•°æ®")

    overlap_table = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®ç±»å‹               â”‚ Binance                      â”‚ Coinalyze                   â”‚ å½“å‰ä½¿ç”¨   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èµ„é‡‘è´¹ç‡ (é¢„æœŸ)         â”‚ /premiumIndex               â”‚ /funding-rate               â”‚ Binance âœ… â”‚
â”‚                        â”‚ lastFundingRate (=predicted) â”‚ value                       â”‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èµ„é‡‘è´¹ç‡ (å·²ç»“ç®—)       â”‚ /fundingRate                â”‚ /funding-rate-history       â”‚ Binance âœ… â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OI (å†å²)              â”‚ /openInterestHist           â”‚ /open-interest-history      â”‚ âŒ éƒ½æ²¡ç”¨   â”‚
â”‚                        â”‚ sumOpenInterest              â”‚ history[].o/h/l/c           â”‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤šç©ºè´¦æˆ·æ¯”              â”‚ /globalLongShortAccountRatioâ”‚ /long-short-ratio-history   â”‚ Binance    â”‚
â”‚                        â”‚ longAccount/shortAccount     â”‚ history[].l/s/r             â”‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤§æˆ·å¤šç©ºæ¯”              â”‚ /topLongShortAccountRatio   â”‚ âŒ æ—                         â”‚ âŒ æ²¡ç”¨     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Taker ä¹°å–æ¯”            â”‚ /takerlongshortRatio        â”‚ âŒ æ—                         â”‚ âŒ æ²¡ç”¨     â”‚
â”‚                        â”‚ buySellRatio                 â”‚                             â”‚ (ç”¨Kçº¿è®¡ç®—) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""
    print(overlap_table)

    print_subheader("3.2 Binance ç‹¬æœ‰æ•°æ® (Coinalyze æ²¡æœ‰)")

    binance_unique = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®                           â”‚ API ç«¯ç‚¹                    â”‚ å½“å‰ä½¿ç”¨   â”‚ æ½œåœ¨ä»·å€¼               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Kçº¿ 12 åˆ—å®Œæ•´æ•°æ®               â”‚ /klines                     â”‚ âœ… éƒ¨åˆ†    â”‚ å·²ç”¨äºè®¢å•æµ           â”‚
â”‚  - taker_buy_volume [9]        â”‚                             â”‚ âœ… æ˜¯      â”‚ ä¹°ç›˜åŠ›é‡               â”‚
â”‚  - taker_buy_quote [10]        â”‚                             â”‚ âŒ å¦      â”‚ ä¹°ç›˜é‡‘é¢ (æ›´ç²¾ç¡®)      â”‚
â”‚  - trades_count [8]            â”‚                             â”‚ âœ… æ˜¯      â”‚ æˆäº¤ç¬”æ•°               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤§æˆ·å¤šç©ºè´¦æˆ·æ¯”                  â”‚ /topLongShortAccountRatio   â”‚ âŒ å¦      â”‚ æœºæ„åŠ¨å‘ï¼Œé¢†å…ˆæŒ‡æ ‡     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤§æˆ·å¤šç©ºæŒä»“æ¯”                  â”‚ /topLongShortPositionRatio  â”‚ âŒ å¦      â”‚ æœºæ„ä»“ä½ï¼Œæ›´æœ‰ä»·å€¼     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Taker å¤šç©ºæ¯”                   â”‚ /takerlongshortRatio        â”‚ âŒ å¦      â”‚ ä¸»åŠ¨ä¹°å–åŠ›é‡å¯¹æ¯”       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ·±åº¦æ•°æ®                       â”‚ /depth                      â”‚ âŒ å¦      â”‚ æŒ‚å•åˆ†å¸ƒï¼Œæ”¯æ’‘é˜»åŠ›     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 24h è¡Œæƒ…ç»Ÿè®¡                   â”‚ /ticker/24hr                â”‚ âŒ å¦      â”‚ æˆäº¤é‡ã€æ¶¨è·Œå¹…ç­‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""
    print(binance_unique)

    print_subheader("3.3 Coinalyze ç‹¬æœ‰æ•°æ® (Binance æ²¡æœ‰)")

    coinalyze_unique = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®                           â”‚ API ç«¯ç‚¹                    â”‚ å½“å‰ä½¿ç”¨   â”‚ æ½œåœ¨ä»·å€¼               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çˆ†ä»“æ•°æ® (å¤šå¤´/ç©ºå¤´åˆ†å¼€)        â”‚ /liquidation-history        â”‚ âœ… æ˜¯      â”‚ æç«¯è¡Œæƒ…ä¿¡å·           â”‚
â”‚  - history[].l (long liq)      â”‚                             â”‚ âœ… æ˜¯      â”‚ å¤šå¤´çˆ†ä»“é‡             â”‚
â”‚  - history[].s (short liq)     â”‚                             â”‚ âœ… æ˜¯      â”‚ ç©ºå¤´çˆ†ä»“é‡             â”‚
â”‚  - history[].t (æ—¶é—´æˆ³)         â”‚                             â”‚ âŒ å¦      â”‚ çˆ†ä»“æ—¶åºåˆ†æ           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OI OHLC æ•°æ®                   â”‚ /open-interest-history      â”‚ âŒ å¦      â”‚ OI è¶‹åŠ¿å˜åŒ–            â”‚
â”‚  - history[].o/h/l/c           â”‚                             â”‚ âŒ å¦      â”‚ OI æ³¢åŠ¨èŒƒå›´            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¢„æµ‹èµ„é‡‘è´¹ç‡                   â”‚ /predicted-funding-rate     â”‚ âŒ æœªæµ‹è¯•  â”‚ æå‰é¢„åˆ¤èµ„é‡‘è´¹         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èšåˆ OI (å¤šäº¤æ˜“æ‰€)              â”‚ /aggregate-open-interest    â”‚ âŒ æœªæµ‹è¯•  â”‚ å…¨å¸‚åœº OI è§†è§’         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""
    print(coinalyze_unique)

    # =========================================================================
    # PART 4: æ•°æ®åˆ©ç”¨ç‡ç»Ÿè®¡
    # =========================================================================
    print_header("PART 4: æ•°æ®åˆ©ç”¨ç‡ç»Ÿè®¡")

    stats = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            æ•°æ®åˆ©ç”¨ç‡æ€»è§ˆ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ğŸ“Š Binance Kçº¿ 12 åˆ—:                                                       â”‚
â”‚     â”œâ”€ âœ… å·²ä½¿ç”¨: 5 åˆ— ([1-5] OHLCV, [7] quote_vol, [8] trades, [9] buy_vol)â”‚
â”‚     â”œâ”€ âŒ æœªä½¿ç”¨: 3 åˆ— ([0] time, [6] close_time, [10] buy_quote, [11] ignore)â”‚
â”‚     â””â”€ åˆ©ç”¨ç‡: 62.5%                                                         â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“Š Binance å…¶ä»– API:                                                        â”‚
â”‚     â”œâ”€ âœ… å·²ä½¿ç”¨: 1 ä¸ª (globalLongShortAccountRatio)                         â”‚
â”‚     â”œâ”€ âŒ æœªä½¿ç”¨: 5 ä¸ª (å¤§æˆ·å¤šç©ºæ¯”x2, Takeræ¯”, æ·±åº¦, 24hè¡Œæƒ…)                â”‚
â”‚     â””â”€ åˆ©ç”¨ç‡: 16.7%                                                         â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“Š Coinalyze API:                                                           â”‚
â”‚     â”œâ”€ âœ… å·²ä½¿ç”¨: 3 ä¸ªç«¯ç‚¹ (OI, Funding, Liquidation)                        â”‚
â”‚     â”œâ”€ âŒ æœªä½¿ç”¨: 3+ ä¸ªç«¯ç‚¹ (å†å²æ•°æ®, é¢„æµ‹è´¹ç‡, èšåˆæ•°æ®)                    â”‚
â”‚     â”œâ”€ âœ… å·²ä½¿ç”¨å­—æ®µ: 5 ä¸ª (symbol, value x2, l, s)                          â”‚
â”‚     â”œâ”€ âŒ æœªä½¿ç”¨å­—æ®µ: 4+ ä¸ª (update x3, history[].t, OHLC...)               â”‚
â”‚     â””â”€ åˆ©ç”¨ç‡: ~40%                                                          â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“Š æ€»ä½“åˆ©ç”¨ç‡: çº¦ 35-40%                                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""
    print(stats)

    # =========================================================================
    # PART 5: æ”¹è¿›å»ºè®®
    # =========================================================================
    print_header("PART 5: é«˜ä»·å€¼æ”¹è¿›å»ºè®®")

    suggestions = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¼˜å…ˆçº§   â”‚ æ”¹è¿›é¡¹                              â”‚ é¢„æœŸæ”¶ç›Š                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”´ P0   â”‚ æ·»åŠ  Binance å¤§æˆ·å¤šç©ºæŒä»“æ¯”           â”‚ æœºæ„åŠ¨å‘é¢†å…ˆæŒ‡æ ‡          â”‚
â”‚          â”‚ /topLongShortPositionRatio          â”‚ æ¯”è´¦æˆ·æ¯”æ›´æœ‰ä»·å€¼          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”´ P0   â”‚ ä½¿ç”¨ OI å†å²è®¡ç®—å˜åŒ–ç‡                â”‚ OIâ†‘+ä»·æ ¼â†‘=è¶‹åŠ¿ç¡®è®¤        â”‚
â”‚          â”‚ Coinalyze /open-interest-history    â”‚ OIâ†“=è¶‹åŠ¿å‡å¼±             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŸ¡ P1   â”‚ æ·»åŠ  Binance Taker å¤šç©ºæ¯”            â”‚ ä¸»åŠ¨ä¹°å–åŠ›é‡å¯¹æ¯”          â”‚
â”‚          â”‚ /takerlongshortRatio                â”‚ æ¯” Kçº¿è®¡ç®—æ›´ç›´æ¥          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŸ¡ P1   â”‚ ä½¿ç”¨èµ„é‡‘è´¹ç‡å†å²è¶‹åŠ¿                 â”‚ è´¹ç‡æŒç»­èµ°é«˜=å¤šå¤´è¿‡çƒ­     â”‚
â”‚          â”‚ Coinalyze /funding-rate-history     â”‚ é¢„è­¦æŒ¤å‹é£é™©             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŸ¢ P2   â”‚ äº¤å‰éªŒè¯å¤šç©ºæ¯”                       â”‚ Binance vs Coinalyze     â”‚
â”‚          â”‚ ä¸¤ä¸ªæ•°æ®æºå¯¹æ¯”                       â”‚ æ•°æ®å¼‚å¸¸æ£€æµ‹             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŸ¢ P2   â”‚ ä½¿ç”¨ taker_buy_quote [10]           â”‚ ä¹°ç›˜é‡‘é¢æ¯”æ•°é‡æ›´ç²¾ç¡®      â”‚
â”‚          â”‚ æ›¿ä»£ taker_buy_volume               â”‚ æ¶ˆé™¤ä»·æ ¼å½±å“             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŸ¢ P3   â”‚ æ·»åŠ æ·±åº¦æ•°æ®                         â”‚ å¤§å•æŒ‚å•æ£€æµ‹             â”‚
â”‚          â”‚ /depth (ä¹°å–ç›˜å£)                    â”‚ æ”¯æ’‘é˜»åŠ›ä½è¯†åˆ«           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ å®æ–½é¡ºåºå»ºè®®: P0 (ç«‹å³) â†’ P1 (æœ¬å‘¨) â†’ P2 (ä¸‹å‘¨) â†’ P3 (æœªæ¥)
"""
    print(suggestions)

    print("\n" + "=" * 70)
    print("  âœ… è¯Šæ–­å®Œæˆ!")
    print("=" * 70)


if __name__ == "__main__":
    main()
