---
name: code-review
description: ä»£ç å®¡æŸ¥ - å¤šç»´åº¦å®¡æŸ¥ä»£ç å˜æ›´ï¼Œæ£€æŸ¥ bugsã€å®‰å…¨é—®é¢˜ã€æ¶æ„åˆè§„æ€§ã€‚Use for reviewing code changes, PR reviews, or pre-commit checks.
argument-hint: "[--staged|--all|--pr <number>|--branch|--file <path>]"
allowed-tools: Bash, Read, Grep, Glob, Task, WebFetch
---

# ä»£ç å®¡æŸ¥ (Code Review)

åŸºäº Claude Code å®˜æ–¹æœ€ä½³å®è·µçš„å¤šç»´åº¦ä»£ç å®¡æŸ¥æŠ€èƒ½ã€‚

## å‚æ•°è§£æ

ç”¨æˆ·å‚æ•°: `$ARGUMENTS`

æ ¹æ®å‚æ•°é€‰æ‹©å®¡æŸ¥æ¨¡å¼ï¼š

| å‚æ•° | æ¨¡å¼ | å‘½ä»¤ |
|------|------|------|
| (ç©º) æˆ– `--staged` | staged | `git diff --cached` |
| `--unstaged` | unstaged | `git diff` |
| `--all` | all | `git diff HEAD` |
| `--pr <number>` | PR | `gh pr diff <number>` |
| `--commit <hash>` | commit | `git show <hash>` |
| `--branch` | branch | `git diff main...HEAD` |
| `--file <path>` | file | ç›´æ¥è¯»å–æ–‡ä»¶ |

## æ‰§è¡Œæµç¨‹

### Step 1: è·å–ä»£ç å˜æ›´

æ ¹æ®è§£æçš„æ¨¡å¼æ‰§è¡Œå¯¹åº”å‘½ä»¤è·å– diffã€‚

**é»˜è®¤è¡Œä¸º (æ— å‚æ•°æ—¶)**:
```bash
git diff --cached
```

å¦‚æœæš‚å­˜åŒºä¸ºç©ºï¼Œæç¤ºç”¨æˆ·ä½¿ç”¨ `--all` æˆ– `--unstaged`ã€‚

### Step 2: å¤šç»´åº¦å¹¶è¡Œå®¡æŸ¥

ä½¿ç”¨ Task å·¥å…·å¯åŠ¨ 4 ä¸ªç‹¬ç«‹çš„å®¡æŸ¥ä»£ç†å¹¶è¡Œæ‰§è¡Œï¼š

#### Agent 1: Bug æ£€æµ‹ (Bug Scanner)
æ£€æŸ¥é¡¹:
- é€»è¾‘é”™è¯¯ã€è¾¹ç•Œæ¡ä»¶ã€ç©ºæŒ‡é’ˆã€ç±»å‹é”™è¯¯
- å¼‚å¸¸å¤„ç†ç¼ºå¤±ã€èµ„æºæ³„æ¼
- å¹¶å‘é—®é¢˜ã€ç«æ€æ¡ä»¶
- ç¡¬ç¼–ç å€¼ã€é­”æ³•æ•°å­—

#### Agent 2: å®‰å…¨å®¡æŸ¥ (Security Reviewer)
æ£€æŸ¥é¡¹:
- OWASP Top 10 æ¼æ´
- è¾“å…¥éªŒè¯ç¼ºå¤±
- æ•æ„Ÿä¿¡æ¯æ³„éœ² (API keys, passwords, tokens)
- SQL/å‘½ä»¤æ³¨å…¥é£é™©
- ä¸å®‰å…¨çš„ä¾èµ–

#### Agent 3: æ¶æ„ä¸ä»£ç è´¨é‡ (Architecture Reviewer)
æ£€æŸ¥é¡¹:
- CLAUDE.md è§„èŒƒåˆè§„æ€§
- ä»£ç é£æ ¼ä¸€è‡´æ€§
- å‘½åè§„èŒƒ (å˜é‡ã€å‡½æ•°ã€ç±»)
- å‡½æ•°å¤æ‚åº¦ (åœˆå¤æ‚åº¦ > 10 è­¦å‘Š)
- é‡å¤ä»£ç ã€è¿‡åº¦å·¥ç¨‹

#### Agent 4: é¡¹ç›®ç‰¹å®šæ£€æŸ¥ (Project-Specific)
é’ˆå¯¹ AItrader é¡¹ç›®:
- æ­¢æŸéªŒè¯: LONG æ­¢æŸ < å…¥åœºä»·, SHORT æ­¢æŸ > å…¥åœºä»·
- API å¯†é’¥å¿…é¡»ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œç¦æ­¢ç¡¬ç¼–ç 
- NautilusTrader API ä½¿ç”¨æ˜¯å¦æ­£ç¡®
- å…¥å£æ–‡ä»¶å¿…é¡»æ˜¯ `main_live.py` (é `main.py`)
- Telegram é€šçŸ¥é…ç½®æ­£ç¡®æ€§

### Step 3: ç½®ä¿¡åº¦è¯„åˆ†

æ¯ä¸ªå‘ç°çš„é—®é¢˜éœ€è¦è¯„ä¼°ç½®ä¿¡åº¦:

| åˆ†æ•° | å«ä¹‰ | è¡Œä¸º |
|------|------|------|
| 0-49 | å¯èƒ½è¯¯æŠ¥ | ä¸æŠ¥å‘Š |
| 50-79 | ä¸­ç­‰ç½®ä¿¡åº¦ | åˆ—å…¥"å»ºè®®æ”¹è¿›"éƒ¨åˆ† |
| 80-100 | é«˜ç½®ä¿¡åº¦ | å¿…é¡»æŠ¥å‘Š |

**é»˜è®¤é˜ˆå€¼: â‰¥80%**

### Step 4: è¾“å‡ºæ ¼å¼

```markdown
# ä»£ç å®¡æŸ¥æŠ¥å‘Š

## æ¦‚è¦
- å®¡æŸ¥èŒƒå›´: [æ¨¡å¼æè¿°]
- æ–‡ä»¶æ•°: N
- é«˜ç½®ä¿¡åº¦é—®é¢˜: N

## å‘ç°çš„é—®é¢˜

### ğŸ”´ [Critical] é—®é¢˜æ ‡é¢˜
- **æ–‡ä»¶**: path/to/file.py:123
- **ç½®ä¿¡åº¦**: 95%
- **ç±»å‹**: Bug | Security | Architecture | Project
- **æè¿°**: é—®é¢˜è¯¦ç»†æè¿°
- **å»ºè®®**: ä¿®å¤å»ºè®®

### ğŸŸ  [High] é—®é¢˜æ ‡é¢˜
...

## å»ºè®®æ”¹è¿› (ç½®ä¿¡åº¦ 50-79%)
- é—®é¢˜åˆ—è¡¨

## ç»“è®º
âœ… å®¡æŸ¥é€šè¿‡ / âŒ å‘ç° N ä¸ªé«˜ç½®ä¿¡åº¦é—®é¢˜éœ€è¦ä¿®å¤
```

## ä¸¥é‡çº§åˆ«

| çº§åˆ« | å›¾æ ‡ | ç½®ä¿¡åº¦ | è¯´æ˜ |
|------|------|--------|------|
| Critical | ğŸ”´ | â‰¥90% | é˜»æ­¢åˆå¹¶ |
| High | ğŸŸ  | â‰¥85% | åº”è¯¥ä¿®å¤ |
| Medium | ğŸŸ¡ | â‰¥80% | å»ºè®®ä¿®å¤ |
| Low | ğŸ”µ | â‰¥70% | å¯é€‰ |

## ä½¿ç”¨ç¤ºä¾‹

```bash
# å®¡æŸ¥æš‚å­˜åŒº (é»˜è®¤)
/code-review

# å®¡æŸ¥æ‰€æœ‰æœ¬åœ°æ›´æ”¹
/code-review --all

# å®¡æŸ¥ PR #123
/code-review --pr 123

# å®¡æŸ¥å½“å‰åˆ†æ”¯ä¸ main çš„å·®å¼‚
/code-review --branch

# å®¡æŸ¥ç‰¹å®šæ–‡ä»¶
/code-review --file strategy/deepseek_strategy.py
```

## CLAUDE.md åˆè§„æ£€æŸ¥

å¿…é¡»éªŒè¯çš„è§„èŒƒ:
1. å…¥å£æ–‡ä»¶: `main_live.py` (é `main.py`)
2. æ­¢æŸé€»è¾‘: éªŒè¯æ–¹å‘æ­£ç¡®æ€§
3. API å¯†é’¥: ä½¿ç”¨ `.env` ç¯å¢ƒå˜é‡
4. Python ç‰ˆæœ¬: 3.11+
5. NautilusTrader ç‰ˆæœ¬: 1.221.0

## å…³é”®æ–‡ä»¶

| æ–‡ä»¶ | å®¡æŸ¥é‡ç‚¹ |
|------|----------|
| `strategy/deepseek_strategy.py` | æ­¢æŸé€»è¾‘ã€äº¤æ˜“ä¿¡å· |
| `utils/*.py` | API è°ƒç”¨ã€é”™è¯¯å¤„ç† |
| `patches/*.py` | å…¼å®¹æ€§ã€å‰¯ä½œç”¨ |
| `main_live.py` | é…ç½®ã€åˆå§‹åŒ– |

## CI/CD é›†æˆ

### GitHub Actions
```yaml
- name: Code Review
  run: |
    claude -p "/code-review --all" --output-format json
```

### Pre-commit Hook
```bash
#!/bin/bash
# .git/hooks/pre-commit
claude -p "/code-review --staged"
```
